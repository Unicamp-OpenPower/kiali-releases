matrix:
  include:
  - env: version=0.16.1
  - env: version=0.16.0
  - env: version=0.15.0
  - env: version=0.14.0
  - env: version=0.13.0
  - env: version=0.12.0
  - env: version=0.11.0
  - env: version=0.10.1
  - env: version=0.10.0
  - env: version=0.9.1

sudo: required

os: 
  - linux-ppc64le
  
services:
- docker

language: go

go:
- 1.9.4

before_script:
  - pwd
  - ls
  - cd $GOPATH/src/github.com
  - mkdir kiali
  - cd kiali
  - wget https://github.com/kiali/kiali/archive/v$version.zip
  - unzip v$version.zip
  - mv kiali-$version kiali
  - cd kiali 
  - rm Makefile
  - mv /home/travis/gopath/src/github.com/Unicamp-OpenPower/kiali-releases/Makefile $GOPATH/src/github.com/kiali/kiali/Makefile
 
install:   
 - wget https://oplab9.parqtec.unicamp.br/pub/ppc64el/glide/glide-0.13.1
 - mv glide-0.13.1 glide
 - sudo chmod 755 glide
 - sudo mv glide /usr/bin/glide
 - glide
 - sudo apt update
 - sudo apt install lftp

script:
  - ls
  - make build
  - make test
  - ls
  - cd $GOPATH/bin
  - mv kiali kiali-$version
  - lftp -c "open -u $USER,$PASS ftp://oplab9.parqtec.unicamp.br; put -O /ppc64el/kiali kiali-$version"
